// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
    previewFeatures = ["fullTextSearch", "fullTextIndex"]
}

datasource db {
  provider = "postgresql"
//   provider = "mysql"
  url = env("DATABASE_URL")
//   relationMode = "prisma"
}

// datasource db {
    // provider = "postgresql"
    // url      = env("DATABASE_URL")
// }

enum Role {
  USER
  PRO
  PRO_PLUS
  BIG_DECK_ENERGY
  EDITOR
  ADMIN
}

model User {
    id            String    @id @default(cuid())
    name          String?
    email         String?   @unique
    emailVerified DateTime?
    username      String?
    image         String?
    bio           String?
    role          Role @default(USER)
    apps         App[]
    recentApps   UserActionApp[]
    bootVideos   BootVideo[]
    games   Game[]
    launcherCredentials UserLauncherCredential[]
    appPlatforms   UserAppPlatform[]
}

model UserActionApp {
    user    User   @relation(fields: [userId], references: [id], onDelete: Cascade)
    userId  String
    app     App    @relation(fields: [appId], references: [id], onDelete: Cascade)
    appId   String
    recentAt DateTime?
    favoritedAt DateTime?
    hideAt DateTime?
    updatedAt DateTime @updatedAt
    createdAt DateTime @default(now())

    @@id([userId, appId])
}

model UserAppPlatform {
    name   String
    user    User   @relation(fields: [userId], references: [id], onDelete: Cascade)
    userId  String
    app     App    @relation(fields: [appId], references: [id], onDelete: Cascade)
    appId   String
    platform Platform @default(OTHER)
    installedAt DateTime?
    runningAt  DateTime?
    updatingAt DateTime?
    addedToSteamAt DateTime?
    // currentVersion     AppVersion    @relation(fields: [currentVersionId], references: [], onDelete: Cascade)
    // currentVersionId String?
    updatedAt DateTime @updatedAt
    createdAt DateTime @default(now())

    @@id([userId, platform])
}

enum AppType {
    GAME
    APP
    TOOL
    MOD
    EMULATOR
    BOOT_VIDEO    
}

enum AppStatus {
    PUBLISHED
    HIDDEN
    BETA
    ALPHA
    DEV
    PREVIEW
    PERSONAL
    IN_REVIEW
    DRAFT
    REJECTED    
    DELETED    
}

model Launcher {
    id      String @id @default(cuid())
    name    String
    url     String
    description String?
    iconUrl    String?
    coverUrl    String?
    company String?
    companyUrl String?
    updatedAt DateTime @updatedAt
    createdAt DateTime @default(now())
    type    AppStatus @default(DRAFT)
    typeAt DateTime @default(now())
    category String @default("Games")
    userLauncherCredentials UserLauncherCredential[]
}

model UserLauncherCredential {
    id      String @id @default(cuid())
    user    User   @relation(fields: [userId], references: [id], onDelete: Cascade)
    userId  String
    launcher Launcher @relation(fields: [launcherId], references: [id], onDelete: Cascade)
    launcherId String
    expires_in Int?
    access_token String?
    refresh_token String?
    user_id String?
    loginTime Int?
    error String?
    username String?
    password String?
}

enum AppStore {
    STEAM
    GOG
    EPIC
    ORIGIN
    UPLAY
    FLATPAK
    SNAP
    PACMAN
    OTHER 
}

enum AppRunnerType {
    EXE
    MSI
    DMG
    DEB
    RPM
    WEB
    FLATPAK
    APPIMAGE
    UNKNOWN
    BASH
}

enum Platform {
    WINDOWS
    LINUX
    STEAMOS
    MAC
    ANDROID
    IOS
    WEB
    OTHER
}

model AppVersion {
    id      String @id @default(cuid())
    version String @default("0.0.0")
    sourceUrl     String 
    name     String?
    uninstallUrl     String? 
    app     App    @relation(fields: [appId], references: [id], onDelete: Cascade)
    appId   String
    duration Int @default(0)
    size Int @default(0)
    sha256 String?
    store AppStore?
    storeUrl String?
    platform Platform @default(OTHER)
    runnerType AppRunnerType @default(UNKNOWN)
    installLocation String?
    runnerLocation String?
    saveLocation String?
    isRecommended   Boolean @default(false)
    status AppStatus @default(DRAFT)
    changelog   String?
    updatedAt DateTime @updatedAt
    createdAt DateTime @default(now())
}

enum MediaSteamType {
    COVER
    ICON
    BANNER
    OTHER
}

enum MediaType {
    IMAGE
    VIDEO
    AUDIO
    DOCUMENT
    OTHER
}

model Media {
    id      String @id @default(cuid())
    name    String
    url     String
    description String?
    type    MediaType @default(OTHER)
    steamType MediaSteamType @default(OTHER)
    appId   String
    updatedAt DateTime @updatedAt
    createdAt DateTime @default(now())
    apps AppMedia[]
    games GameMedia[]
}

model AppMedia {
    media    Media   @relation(fields: [mediaId], references: [id], onDelete: Cascade)
    mediaId  String
    app     App    @relation(fields: [appId], references: [id], onDelete: Cascade)
    appId   String

    @@id([mediaId, appId])
}

model App {
    id      String @id @default(cuid())
    name    String
    url     String?
    description String?
    iconUrl    String?
    coverUrl    String?
    authorName String?
    authorUrl String?
    publisherName String?
    publisherUrl String?
    updatedAt DateTime @updatedAt
    createdAt DateTime @default(now())
    owner    User?   @relation(fields: [ownerId], references: [id], onDelete: Cascade)
    ownerId  String?
    type    AppStatus? @default(DRAFT)
    typeAt DateTime @default(now())
    category String? @default("Entertainment")
    subCategory String? @default("Other")
    // platforms Platform[] @default([])
    appMedia AppMedia[]
    userActions   UserActionApp[]
    versions AppVersion[]
    userPlatforms   UserAppPlatform[]

    // @@fulltext([name])

}

enum BootVideoType {
    STEAM_BOOT 
    STEAM_SUSPEND
}

model BootVideo {
    id      String @id @default(cuid())
    name    String
    url     String
    description String?
    imageUrl    String?
    authorName String?
    authorUrl String?
    duration Int @default(0)
    size Int @default(0)
    isBootVideo Boolean @default(true)
    isSuspendVideo Boolean @default(false)
    user    User?  @relation(fields: [userId], references: [id], onDelete: Cascade)
    userId  String?

    // @@fulltext([name])
}

// model Post {
//     id      String @id @default(cuid())
//     title   String
//     content String
// }


model GameMedia {
    media    Media   @relation(fields: [mediaId], references: [id], onDelete: Cascade)
    mediaId  String
    game     Game    @relation(fields: [gameId], references: [id], onDelete: Cascade)
    gameId   String

    @@id([mediaId, gameId])
}

// TODO: Add GameMod

// Game Details from Steam, GOG, Epic, Origin, Uplay, etc

model Game {
    id      String @id @default(cuid())
    name    String
    url     String?
    description String?
    iconUrl    String?
    coverUrl    String?
    authorName String?
    authorUrl String?
    owner    User?   @relation(fields: [ownerId], references: [id], onDelete: Cascade)
    ownerId  String?
    updatedAt DateTime @updatedAt
    createdAt DateTime @default(now())
    media GameMedia[]

    // @@fulltext([name])
    // @@fulltext([description])
}